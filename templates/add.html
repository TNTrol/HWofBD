{% extends 'base.html' %}

{% block title %}
Add
{% endblock %}

{% block content %}

<form method="post">
<div class = "main">
   <p><select>
   {% for des in despatcher %}
    <option value= {{ des[0] }}>{{des[1]}} {{des[2]}} </option>
   {% endfor %}
   </select>

   <select>
   {% for air in aircraft %}
    <option value= {{ air[0] }}>{{air[1]}}</option>
   {% endfor %}
   </select>
   
   <select>
   {% for air in airline %}
    <option value= {{ air[0] }}>{{air[1]}}</option>
   {% endfor %}
   </select>
   

   </p>
      <button type='button' onclick = "handler()" id='led_on'>Добавить</button>
    <button type='button' onclick = "handler_remove()" id='led_on'>Удалить</button>
   <div class = "jsadd">
   <div class = 'add'>
   <p> 
   <select onChange="change_service(this.selectedIndex)">
    <option value= 0 >Технические работы</option>
    <option value= 1 >Наземные работы</option>
   </select>
   <select class = "service"> 
   	{% for tex in tex_service %}
   	 <option value= {{ tex[0] }}>{{tex[1]}}</option>
  	 {% endfor %}
   </select>
   </p>
   </div>
   </div>
</div>
   <p><input type="submit" value="Отправить"></p>
  </form>
  
  <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.12.0.min.js"><\/script>')</script>
  
  <script> 
  	var arr = [];
  	
  	function my_add(element){
  		arr.push(element);
  	}
  
  	function change_service(index)
  	{
  		if(arr.length == 0)
  		{
  			$.post('/service/'+ index, {},function(data) {
			     // ответ от сервера
			     data.forEach(element => my_add(element));
			     add_to_form(data);
			});
			return;
  		}
  		add_to_form(arr);
  	}
  	
  	function add_to_form(data){ 		
  		var service_list = document.getElementsByClassName('service')[0];
  		var array_option = [];
  		for(i = 0; i < service_list.length; i++){
  			array_option.push([service_list.options[i].value, service_list.options[i].text])
  		}
		
  		service_list.length = 0;
  		for (i = 0; i < arr.length; i++){
		        if (document.createElement){
            			var newHouseListOption = document.createElement("OPTION");
            			newHouseListOption.text = arr[i][1];
            			newHouseListOption.value = arr[i][0];
            			(service_list.options.add) ? service_list.options.add(newHouseListOption) : service_list.add(newHouseListOption, null);
        		}else{
            			service_list.options[i] = new Option(arr[i][0], arr[i][1], false, false);
        		}
  		}
  		arr = new Array();
  		arr = array_option;  	
  	}
	function handler(){
		 var my_ele = document.getElementsByClassName('add')[0].cloneNode(true);
		 document.getElementsByClassName('jsadd')[0].appendChild(my_ele);
	}
	function handler_remove(){
		 var elems = document.getElementsByClassName('jsadd')[0];
		 if(elems.childNodes.length != 3){
		 	elems.removeChild(elems.lastChild)
		 	console.log(elems.childNodes.length);
		 	}
	}
  </script>

{% endblock %}
